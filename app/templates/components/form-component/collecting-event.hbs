{{#dwcm-field-group title=title identifier=title}}
    {{#unless isCreating}}
        <div class="row">
            <div class="col-xs-12">
                {{
                    dwcm-autocomplete-textfield
                    label="fields.labels.collecting_event"

                    storeName="collecting-event"
                    filterField="text1"
                    displayField="givenName"
                    itemSelected=(action "selectedCollectingEvent")

                    labelAction=(action 'enableCreate')
                    actionText='definitions.create-new.1'
                }}
            </div>
        </div>
        {{#if model.collectingEvent}}
            {{dwcm-collecting-event-view model=model.collectingEvent}}
        {{/if}}
    {{else}}
        <div class="row">
            {{
                dwcm-textfield width=8
                label='definitions.name'
                value=model.collectingEvent.givenName
                labelAction=(action 'selectExisting')
                actionText='fields.labels.collecting-event.select-existing'
            }}
            {{
                dwcm-textfield width=4
                label='fields.labels.collecting-event.method'
                value=model.collectingEvent.method
            }}
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="form-group">
                    <label>
                        {{t 'fields.labels.collecting-event.start-date'}}:
                    </label>
                    {{#bs-datetimepicker
                        date=model.collectingEvent.startDate
                        updateDate=(action (mut model.collectingEvent.startDate))
                        format='YYYY-MM-DD'
                        forceDateOutput=true
                    }}
                        {{
                            input disabled=disabled class="form-control"
                            name="Date" placeholder=(t 'fields.placeholder.date-format')
                        }}
                    {{/bs-datetimepicker}}
                </div>
            </div>
            <div class="col-xs-6">
                {{#dwcm-autocomplete-textfield
                    label="fields.labels.collector"

                    multiSelect=true

                    storeName="agent"
                    filterField="lastName"
                    displayField="fullName"
                    itemSelected=(action "createCollector")
                }}
                    <div class="label-group {{if model.collectingEvent.collectors.length '' 'closed'}}">
                        {{#each model.collectingEvent.collectors as |collector|}}
                            <span class="badge">
                                {{collector.agent.fullName}} <i class="glyphicon glyphicon-remove" {{action 'removeCollector' collector}}></i>
                            </span>
                        {{/each}}
                    </div>
                {{/dwcm-autocomplete-textfield}}
            </div>
        </div>
        <div class="row">
            {{
                dwcm-textfield
                width=6

                placeholder='definitions.date'
                value=model.collectingEvent.verbatimDate
            }}
            {{dwcm-textfield width=6 disabled=true placeholder="fields.labels.collecting-event.verbatim-collector"}}
        </div>
        <div class="row">
            <div class="col-xs-12">
                {{
                    dwcm-autocomplete-textfield
                    label="fields.labels.collecting_place"

                    storeName='locality'
                    displayField='localityName'
                    filterField='localityName'

                    itemSelected=(action 'selectedLocality')

                    actionText='definitions.create-new.2'
                    labelAction=(action 'enableCreate')
                }}
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 {{if model.collectingEvent.locality '' 'closed'}}">
                {{#dwcm-highlighted-list list=localityDisplayAttributes}}
                    {{#if model.collectingEvent.locality.latitude1}}
                        {{#leaflet-map
                            lat=model.collectingEvent.locality.latitude1
                            lng=model.collectingEvent.locality.longitude1
                            zoom=5
                        }}
                            {{tile-layer url="http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"}}

                            {{#circle-marker-layer location=model.collectingEvent.locality.location radius=5 color='#ff0000'}}
                                <p>{{model.locality.localityName}}</p>
                            {{/circle-marker-layer}}
                        {{/leaflet-map}}
                    {{/if}}
                {{/dwcm-highlighted-list}}
            </div>
        </div>
    {{/unless}}
{{/dwcm-field-group}}
